<!DOCTYPE html>
<html lang="en">

<head>
    <title>App Testing Page</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/index.css">
    <style>
        /* Special styles that override linked stylesheets. */
    </style>
</head>

<body id="PageBody">
    <div id="AppWrapper">
        <h1>AppLite</h1>
        <p>
            This is purely for testing the JavaScript app.
        </p>
        <h2>Template Testing</h2>
        <div id="TestArea">

        </div>
        <div id="TestArea2">

        </div>
        <div id="TestArea3">

        </div>
        <template data-template-for="TestArea3" data-engine="default">
            <p>What's the animal's name? It's...</p>
            <p><span data-context="animal.name"></span>
                and it has <span data-context="animal.legs"></span> legs!
            </p>
        </template>
        <button data-click="hello">Say Hi</button>

        <hr>
        <h2>Binding Tests</h2>
        <hr>

        <div data-bind="receive:template">
            <template>
                <h2>Places:</h2>
                <ul>
                    {{#places}}
                    <li>{{.}}</li>
                    {{/places}}
                </ul>
            </template>
        </div>
        <div>
            <label for="SomeTextInput">Enter Some Text</label>
            <input type="text" id="SomeTextInput" data-bind="send:value" data-context="someText" data-bind-on="keyup">
            <hr>
            <p data-bind="receive:innerHTML" data-context="someText"></p>
        </div>

    </div>

    <template id="TestTemplate" data-template-for="TestArea2" data-engine="mustache">
        <h2>{{value}}</h2>
    </template>
    <script type="module">

        (async () => {


            let mod = await import('../../../../scripts/app.js');

            let mod2 = await import("./scripts/app.js");

            if (!mod) {
                mod = mod2;
            }

            const app = mod.app;

            document.body.onload = () => {

                // Example: Setup a template where the data AND template need to be downladed. 
                // In this example, are only do 1 function call and everything else is in the settings. 
                // You could leave the settings blank & setup everything with functions as well. 

                let foo = new app.Template({
                    engine: "mustache",
                    autoRender: true,
                    dataUrl: "api/test.json",
                    htmlUrl: "api/partial.html",
                    target: "#TestArea"
                });

                // importPackage returns a promise so we can use the standard then/catch syntax if we want.
                foo.importPackage().catch((error) => {
                    console.log(error);
                });

                let bar = new app.Template({
                    engine: "default",
                    autoRender: true,
                    target: "#TestArea3"
                });

                bar.importContext("api/test.json", true).then(() => {
                    bar.load();
                }).catch((error) => {

                    console.log(error);
                });

                // Let's get some data asynchronously and log it
                app.getJSON("api/test.json")
                    .then((result) => {
                        console.log(`We got this text: ${result.someText}`);
                    }).catch((error) => {
                        console.log(error);
                    });

                // (async () => {

                //     try {
                //         let result = await app.getJSON("api/test.json");
                //         let alert = new Modal(result);
                //         alert.alert();
                //     } catch (error) {
                //         let warning = new Modal(error);
                //         warning.warn();
                //     }
                // })();

                // Let's use an async function to get some HTML data
                // Then let's pop it up on a modal window. 
                async function sayHello() {
                    try {
                        let url = "api/greeting.html";
                        let result = await app.getHTML(url);
                        let message = new app.Modal(result);
                        message.show();
                    }
                    catch (error) {
                        console.log(error);
                    }
                }

                // This function is the SAME as the one above except it doesn't use
                // the async/await syntax and it uses then/catch chaining instead. 
                // Otherwise they're IDENTICAL. Just FYI. 
                function sayHi() {
                    let url = "api/greeting.html";
                    app.getHTML(url)
                        .then((result) => {
                            let message = new app.Modal(result);
                            message.show();
                        }).catch((error) => {
                            console.log(error);
                        });
                }

                // Let's stick this in the click events so it only happens when you click a button. 
                // Normally I wouldn't set events here, just define them in custom_events.js
                app.events.click.hello = sayHello;

                // For fun, let's do an async operation and then calculate how long it took: 
                async function doStuff(url) {
                    let result = await app.getJSON(`api/test.json?_=${Math.random()}`);
                    console.log(result);
                }

                // Start the timer
                let test = new app.Benchmark("Doing Stuff");
                doStuff().then(() => {
                    test.stop(); //Aaaaand TIME!
                    console.log(test.detailedResults)
                });

                app.bindings.setup("api/test.json");
            };


        })();
    </script>
</body>

</html>